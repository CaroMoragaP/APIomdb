<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista de películas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
          crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/estilo.css}" />
    
</head>
<body>
<nav class="navbar">
        <div class="navbar-container" style="justify-content: space-between;">
	        <h2 class="navbar-title" 
	            th:if="${modoCompartidas} == null or !${modoCompartidas}"
	            style="text-align: left; white-space: nowrap; flex: 0 0 auto;">
			    Mis Películas
			</h2>
			<h2 class="navbar-title" 
			    th:if="${modoCompartidas}"
			    style="text-align: left; white-space: nowrap; flex: 0 0 auto;">
			    Películas compartidas para mí
			</h2>

            <div class="navbar-right" style="flex: 0 0 auto;">
            	<form th:action="@{/peli/buscar}" method="get">
            		<input type="submit" value="Volver" class="nav-btn">
            	</form>
            </div>
        </div>
    </nav>

<div class="container">

    <div class="row justify-content-center align-item-center mt-3 mx-5">
        <table class="table table-hover align-item-center text-center">
            <thead>
            <tr>
                <th>Título</th>
                <th>Director</th>
                <th>Año</th>
                <th>Duración</th>
                <th>Poster</th>

                <!-- Solo en modo "Películas compartidas" -->
                <th th:if="${modoCompartidas}">Amigo</th>
                <th th:if="${modoCompartidas}">Valorar</th>
            </tr>
            </thead>
            <tbody>

            <!-- Caso MIS PELÍCULAS: solo llega 'peliculas', sin 'relaciones' ni 'modoCompartidas' -->
            <tr th:if="${modoCompartidas} == null or !${modoCompartidas}"
                th:each="item : ${peliculas}">
                <td>
                    <h4><span th:text="${item.Title}"></span></h4>
                    <form th:action="@{/peli/verPelisUsuario}" th:method="get">
                        <input type="hidden" th:value="${item.imdbID}" name="imdbID" id="imdbID"/>
                        <input class="btn btn-dark btn-sm" type="submit" value="i" style="font-size: 0.85rem; padding: 0.4rem 0.8rem; min-width: 35px;"/>
                    </form>
                </td>
                <td th:text="${item.Director}"></td>
                <td th:text="${item.Year}"></td>
                <td th:text="${item.Runtime}"></td>
                <td>
                    <img class="w-25" th:src="${item.Poster}" style="max-width: 80px;">
                </td>
                <!-- Sin columnas Amigo / Valorar en este modo -->
            </tr>

            <!-- Caso PELÍCULAS COMPARTIDAS: viene 'relaciones' y 'modoCompartidas' = true -->
            <tr th:if="${modoCompartidas}"
                th:each="rel, iterStat : ${relaciones}">
                <td>
                    <h4><span th:text="${rel.pelicula.Title}"></span></h4>
                    <form th:action="@{/peli/verPelisUsuario}" th:method="get">
                        <input type="hidden"
                               th:value="${rel.pelicula.imdbID}"
                               name="imdbID"
                               th:id="'imdbID__' + ${iterStat.index}"/>
                        <input class="btn btn-dark btn-sm" type="submit" value="i" style="font-size: 0.85rem; padding: 0.4rem 0.8rem; min-width: 35px;"/>
                    </form>
                </td>
                <td th:text="${rel.pelicula.Director}"></td>
                <td th:text="${rel.pelicula.Year}"></td>
                <td th:text="${rel.pelicula.Runtime}"></td>
                <td>
                    <img class="w-25" th:src="${rel.pelicula.Poster}" style="max-width: 80px;">
                </td>

                <!-- Amigo que la envió -->
                <td th:text="${rel.usuario.mail}"></td>

                <!-- Valorar o mostrar ranking -->
                <td>
                    <!-- Si aún no tiene ranking (0 = sin valorar) -->
                    <div th:if="${rel.rankingUsuario == 0}">
                        <form th:action="@{/peli/valorarCompartida}" method="post">
                            <input type="hidden" name="imdbID"
                                   th:value="${rel.pelicula.imdbID}"/>

                            <div class="rating" style="display: flex; justify-content: center; gap: 0.3rem;">
                                <input type="radio"
                                       th:id="'star5__' + ${iterStat.index}"
                                       name="rating" value="5"
                                       onclick="this.form.submit()"/>
                                <label th:for="'star5__' + ${iterStat.index}" style="font-size: 1.5rem;">★</label>

                                <input type="radio"
                                       th:id="'star4__' + ${iterStat.index}"
                                       name="rating" value="4"
                                       onclick="this.form.submit()"/>
                                <label th:for="'star4__' + ${iterStat.index}" style="font-size: 1.5rem;">★</label>

                                <input type="radio"
                                       th:id="'star3__' + ${iterStat.index}"
                                       name="rating" value="3"
                                       onclick="this.form.submit()"/>
                                <label th:for="'star3__' + ${iterStat.index}" style="font-size: 1.5rem;">★</label>

                                <input type="radio"
                                       th:id="'star2__' + ${iterStat.index}"
                                       name="rating" value="2"
                                       onclick="this.form.submit()"/>
                                <label th:for="'star2__' + ${iterStat.index}" style="font-size: 1.5rem;">★</label>

                                <input type="radio"
                                       th:id="'star1__' + ${iterStat.index}"
                                       name="rating" value="1"
                                       onclick="this.form.submit()"/>
                                <label th:for="'star1__' + ${iterStat.index}" style="font-size: 1.5rem;">★</label>
                            </div>
                        </form>
                    </div>

                    <!-- Si ya está valorada -->
                    <div th:if="${rel.rankingUsuario != 0}">
                        <span th:text="${rel.rankingUsuario}"></span> / 5
                    </div>
                </td>
            </tr>

            </tbody>
        </table>
    </div>
</div>

    <footer class="footer">
        <p>Carolina Moraga Ponce</p>
    </footer>

</body>
</html>